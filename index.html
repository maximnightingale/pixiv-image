<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="index,follow" />
    <meta name="description" content="免费易用的pixiv图片解析下载工具" />
    <meta name="keywords" content="pixiv,图片解析,图片下载" />
    <meta property="og:title" content="pixiv图片下载">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://maximnightingale.github.io/pixiv-image/">
    <meta property="og:image" content="https://maximnightingale.github.io/pixiv-image/favicon.ico">
    <meta property="og:description" content="免费易用的pixiv图片解析下载工具">
    <title>Pixiv 图片解析</title>
    <style>
      :root {
        --primary: #155dfc;
        --primary-hover: #1447e6;
        --bg: #f9fafb;
        --bg-card: #fff;
        --text: #1e2939;
        --text-light: #6a7282;
        --border: #e5e7eb;
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --success: #00a544;
        --success-hover: #008138;
        --error: #f44336;
        --transition: all 0.3s ease;
        --size: rgba(255, 255, 255, 0.7);
      }
      .dark {
        --bg: #0a0a0a;
        --bg-card: #161b22;
        --text: #ededed;
        --text-light: #99a1af;
        --border: #30363d;
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        --shadow-lg: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
        --size: rgba(0, 0, 0, 0.7);
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: ui-sans-serif, system-ui, sans-serif;
        transition: var(--transition);
      }
      body {
        padding: 1.5rem 1rem;
        background-color: var(--bg);
        color: var(--text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      .container {
        max-width: 1000px;
        width: 100%;
        margin: 0 auto;
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      header {
        text-align: center;
        padding-top: 0.8rem;
        margin-bottom: 1.8rem;
      }
      h1 {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--text);
        margin-top: 0.5rem;
      }
      .input-group {
        display: flex;
        gap: 0.8rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        border-radius: 8px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
        background: var(--bg-card);
        padding: 1.5rem;
      }
      #pixivUrl {
        flex: 1;
        min-width: 250px;
        padding: 1rem;
        border: 1px solid var(--border);
        border-radius: 8px;
        background-color: var(--bg-card);
        color: var(--text);
        font-size: 1rem;
        outline: 0;
      }
      #pixivUrl:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(21, 93, 252, 0.1);
      }
      #submitBtn {
        padding: 0 2rem;
        background-color: var(--primary-hover);
        color: white;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        white-space: nowrap;
        box-shadow: var(--shadow);
      }
      #submitBtn:hover {
        color: #fff;
        box-shadow: var(--shadow-lg);
        border-color: transparent;
      }
      .theme-toggle {
        position: absolute;
        top: 1.5rem;
        right: 1.5rem;
        background: var(--bg-card);
        border: 1px solid var(--border);
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: var(--text);
      }
      .theme-toggle:hover {
        background-color: var(--bg);
        box-shadow: var(--shadow);
      }
      #result {
        margin-top: 1rem;
        gap: 1.2rem;
        display: flex;
        flex-direction: column;
        flex: 1;
      }
      .image-card {
        background: var(--bg-card);
        padding: 1rem;
        border-radius: 8px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
      }
      .preview-img {
        width: 100%;
        border-radius: 6px;
        margin-bottom: 0.8rem;
        border: 1px solid var(--border);
        max-width: 100%;
        height: auto;
      }
      .download-btn {
        display: inline-block;
        width: 100%; 
        padding: 0.6rem 1.2rem;
        background-color: var(--success);
        color: #fff;
        text-align: center;
        text-decoration: none;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 500;
      }
      .download-btn:hover {
        background-color: var(--success-hover);
        box-shadow: var(--shadow);
      }
      .error {
        color: var(--error);
        background-color: rgba(244, 67, 54, 0.1);
        padding: 1rem;
        border-radius: 8px;
        border: 1px solid rgba(244, 67, 54, 0.2);
        text-align: center;
        margin-top: 1rem;
      }
      .original-link-container {
        display: none;
        margin-bottom: 1.5rem;
        text-align: center;
      }
      .original-link-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.6rem;
        padding: 0.8rem 2rem;
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-hover)
        );
        color: white;
        text-decoration: none;
        border-radius: 50px;
        font-size: 1rem;
        font-weight: 500;
        box-shadow: var(--shadow);
        border: 2px solid transparent;
        transition: all 0.3s ease;
      }
      .original-link-btn:hover {
        box-shadow: var(--shadow-lg);
        transform: translateY(-2px);
        border-color: rgba(255, 255, 255, 0.3);
      }
      .modal-img-container {
        max-width: 90vw;
        max-height: 80vh;
        overflow: visible;
        position: relative;
        cursor: grab;
      }
      .modal-img-container.grabbing {
        cursor: grabbing;
      }
      #modalOriginalImg {
        max-width: none;
        max-height: none;
        width: 100%;
        height: auto;
        transform-origin: center center;
        transition: transform 0.1s ease-out;
      }
      .img-size-info {
        position: static;
        padding: 0.4rem 1.2rem;
        font-size: 0.9rem;
        background: var(--size);
        border-radius: 6px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        white-space: nowrap;
        min-width: 80px;
      }
      .zoom-hint {
        position: absolute;
        bottom: 1rem;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.6);
        color: #fff;
        padding: 0.4rem 1rem;
        border-radius: 20px;
        font-size: 0.8rem;
        z-index: 10;
      }
      .modal-control-btn {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        border: none;
        background: var(--primary);
        color: #fff;
        font-size: 1.2rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }
      .modal-control-btn:disabled {
        background: #666;
        cursor: not-allowed;
        opacity: 0.6;
      }
      .modal-control-btn:hover:not(:disabled) {
        background: var(--primary-hover);
        transform: scale(1.05);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }
      @media (max-width: 768px) {
        h1 {
          font-size: 2rem;
        }
        .input-group {
          flex-direction: column;
        }
        #submitBtn {
          width: 100%;
          padding: 1rem;
        }
        .theme-toggle {
          top: 1rem;
          right: 1rem;
          width: 36px;
          height: 36px;
        }
        .download-btn {
          width: 100%;
          text-align: center;
        }
        .original-link-btn {
          width: 100%;
          justify-content: center;
        }
        .zoom-hint {
          font-size: 0.75rem;
          padding: 0.3rem 0.8rem;
        }
        .modal-control-btn {
          width: 40px;
          height: 40px;
          font-size: 1.1rem;
        }
        .img-size-info {
          height: 40px;
          padding: 0.3rem 0.8rem;
          font-size: 0.85rem;
        }
      }
    </style>
  </head>
  <body>
    <button class="theme-toggle" id="themeToggle" aria-label="切换主题">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path
          d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"
        ></path>
      </svg>
    </button>
    <div class="container">
      <header>
        <h1>Pixiv 图片解析</h1>
      </header>
      <div class="input-group">
        <input
          type="search"
          id="pixivUrl"
          placeholder="输入 Pixiv 作品链接或 PID"
        />
        <button id="submitBtn">解析</button>
      </div>
      <div class="original-link-container" id="originalLinkContainer">
        <a
          id="originalLinkBtn"
          class="original-link-btn"
          target="_blank"
          rel="noopener noreferrer"
        >
          前往 Pixiv 原作品页面
        </a>
      </div>
      <div id="result"></div>
    </div>
    <div
      id="imageModal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.8);
        z-index: 999;
        align-items: center;
        justify-content: center;
        padding: 1rem;
      "
    >
      <button
        id="closeModal"
        style="
          position: absolute;
          top: 1.5rem;
          right: 1.5rem;
          background: #fff;
          border: none;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          font-size: 1.2rem;
          cursor: pointer;
          color: #000;
          z-index: 100;
        "
      >
        ×
      </button>
      <div class="modal-img-container" id="modalImgContainer">
        <img id="modalOriginalImg" alt="原图" />
      </div>
      <div
        style="
          position: absolute;
          bottom: 5rem;
          left: 50%;
          transform: translateX(-50%);
          display: flex;
          gap: 1rem;
          z-index: 100;
          align-items: center;
        "
      >
        <button id="prevImgBtn" class="modal-control-btn" disabled="disabled">
          &lt;
        </button>
        <button id="zoomInBtn" class="modal-control-btn">+</button>
        <div class="img-size-info" id="imgSizeInfo">加载中...</div>
        <button id="zoomOutBtn" class="modal-control-btn">-</button>
        <button id="nextImgBtn" class="modal-control-btn" disabled="disabled">
          &gt;
        </button>
      </div>
    </div>
    <div
      id="toast"
      style="
        position: fixed;
        top: 2rem;
        left: 50%;
        transform: translateX(-50%);
        padding: 0.8rem 1.5rem;
        background: var(--bg-card);
        color: var(--text);
        border-radius: 8px;
        box-shadow: var(--shadow-lg);
        z-index: 1000;
        display: none;
        transition: all 0.3s ease;
      "
    ></div>
    <script>
      const submitBtn = document.getElementById("submitBtn"),
        pixivUrlInput = document.getElementById("pixivUrl"),
        resultContainer = document.getElementById("result"),
        themeToggle = document.getElementById("themeToggle"),
        imageModal = document.getElementById("imageModal"),
        modalOriginalImg = document.getElementById("modalOriginalImg"),
        modalImgContainer = document.getElementById("modalImgContainer"),
        closeModal = document.getElementById("closeModal"),
        toast = document.getElementById("toast"),
        imgSizeInfo = document.getElementById("imgSizeInfo"),
        prevImgBtn = document.getElementById("prevImgBtn"),
        nextImgBtn = document.getElementById("nextImgBtn"),
        zoomInBtn = document.getElementById("zoomInBtn"),
        zoomOutBtn = document.getElementById("zoomOutBtn"),
        proxyDomains = ["https://i.muxmus.com", "https://pixiv.shojo.cn/"];
      const originalLinkBtn = document.getElementById("originalLinkBtn");
      const originalLinkContainer = document.getElementById(
        "originalLinkContainer",
      );
      let currentArtworkId = null,
        selectedProxyDomain = null,
        scaleRatio = 1,
        translateX = 0,
        translateY = 0,
        isDragging = !1,
        startX = 0,
        startY = 0,
        startTranslateX = 0,
        startTranslateY = 0;
      const minScale = 0.5,
        maxScale = 3;
      let currentImgIndex = 0,
        currentImgList = [];
      function initTheme() {
        ("true" === localStorage.getItem("darkMode") ||
          (!localStorage.getItem("darkMode") &&
            window.matchMedia("(prefers-color-scheme: dark)").matches)) &&
          document.documentElement.classList.add("dark");
      }
      function showToast(t, e = "info") {
        ((toast.textContent = t),
          (toast.style.display = "block"),
          "success" === e
            ? ((toast.style.background = "var(--success)"),
              (toast.style.color = "#fff"))
            : "error" === e
              ? ((toast.style.background = "var(--error)"),
                (toast.style.color = "#fff"))
              : ((toast.style.background = "var(--bg-card)"),
                (toast.style.color = "var(--text)")),
          setTimeout(() => {
            toast.style.display = "none";
          }, 3e3));
      }
      function resetModalState() {
        ((scaleRatio = 1),
          (translateX = 0),
          (translateY = 0),
          updateImageTransform(),
          (imgSizeInfo.textContent = "加载中..."));
      }
      function updateImageTransform() {
        modalOriginalImg.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scaleRatio})`;
      }
      (themeToggle.addEventListener("click", () => {
        const t = document.documentElement.classList.toggle("dark");
        localStorage.setItem("darkMode", t);
      }),
        initTheme(),
        closeModal.addEventListener("click", () => {
          ((imageModal.style.display = "none"), resetModalState());
        }),
        imageModal.addEventListener("click", (t) => {
          t.target === imageModal &&
            ((imageModal.style.display = "none"), resetModalState());
        }),
        modalImgContainer.addEventListener("mousedown", (t) => {
          0 === t.button &&
            ((isDragging = !0),
            (startX = t.clientX),
            (startY = t.clientY),
            (startTranslateX = translateX),
            (startTranslateY = translateY),
            modalImgContainer.classList.add("grabbing"),
            (document.body.style.userSelect = "none"));
        }),
        document.addEventListener("mousemove", (t) => {
          if (!isDragging) return;
          t.preventDefault();
          const e = t.clientX - startX,
            n = t.clientY - startY;
          ((translateX = startTranslateX + e),
            (translateY = startTranslateY + n),
            updateImageTransform());
        }),
        document.addEventListener("mouseup", () => {
          isDragging &&
            ((isDragging = !1),
            modalImgContainer.classList.remove("grabbing"),
            (document.body.style.userSelect = ""));
        }),
        document.addEventListener("mouseleave", () => {
          isDragging &&
            ((isDragging = !1),
            modalImgContainer.classList.remove("grabbing"),
            (document.body.style.userSelect = ""));
        }));
      let initialDistance = 0,
        startScale = 0;
      (modalImgContainer.addEventListener("touchstart", (t) => {
        if (1 === t.touches.length) {
          const e = t.touches[0];
          ((startX = e.clientX),
            (startY = e.clientY),
            (startTranslateX = translateX),
            (startTranslateY = translateY),
            (isDragging = !0));
        } else if (2 === t.touches.length) {
          const e = t.touches[0],
            n = t.touches[1];
          ((initialDistance = getDistance(e, n)), (startScale = scaleRatio));
        }
      }),
        modalImgContainer.addEventListener("touchmove", (t) => {
          if ((t.preventDefault(), 1 === t.touches.length && isDragging)) {
            const e = t.touches[0],
              n = e.clientX - startX,
              a = e.clientY - startY;
            ((translateX = startTranslateX + n),
              (translateY = startTranslateY + a),
              updateImageTransform());
          } else if (2 === t.touches.length) {
            const e = getDistance(t.touches[0], t.touches[1]);
            let n = startScale * (e / initialDistance);
            n = Math.min(3, Math.max(0.5, n));
            const a = modalImgContainer.getBoundingClientRect(),
              r = a.left + a.width / 2,
              o = a.top + a.height / 2,
              i = modalOriginalImg.getBoundingClientRect(),
              s = i.left + i.width / 2,
              l = i.top + i.height / 2,
              c = (n / scaleRatio) * (r - s),
              d = (n / scaleRatio) * (o - l);
            ((scaleRatio = n),
              (translateX += c),
              (translateY += d),
              updateImageTransform());
          }
        }),
        modalImgContainer.addEventListener("touchend", () => {
          isDragging = !1;
        }));
      const scaleStep = 0.2;
      function scaleImage(t) {
        if ((t = Math.min(3, Math.max(0.5, t))) === scaleRatio) return;
        const e = modalImgContainer.getBoundingClientRect(),
          n = e.left + e.width / 2,
          a = e.top + e.height / 2,
          r = modalOriginalImg.getBoundingClientRect(),
          o = r.left + r.width / 2,
          i = r.top + r.height / 2,
          s = (t / scaleRatio) * (n - o),
          l = (t / scaleRatio) * (a - i);
        ((scaleRatio = t),
          (translateX += s),
          (translateY += l),
          updateImageTransform());
      }
      function getDistance(t, e) {
        const n = e.clientX - t.clientX,
          a = e.clientY - t.clientY;
        return Math.sqrt(n * n + a * a);
      }
      function updateModalImage() {
        const t = currentImgList[currentImgIndex];
        ((modalOriginalImg.src = t.originalUrl),
          resetModalState(),
          updateNavBtnState());
      }
      function updateNavBtnState() {
        ((prevImgBtn.disabled = 0 === currentImgIndex),
          (nextImgBtn.disabled =
            currentImgIndex === currentImgList.length - 1));
      }
      function extractArtworkId(t) {
        if (/^\d+$/.test(t.trim())) return t.trim();
        const e = t.match(/artworks\/(\d+)/);
        return e ? e[1] : null;
      }
      function checkImageValidity(t) {
        return new Promise((e) => {
          const n = setTimeout(() => e(!1), 5e3),
            a = new Image();
          ((a.onload = () => {
            (clearTimeout(n), e(!0));
          }),
            (a.onerror = () => {
              (clearTimeout(n), e(!1));
            }),
            (a.src = t));
        });
      }
      async function selectProxyDomain(t) {
        for (const e of proxyDomains) {
          const n = `${e}/${t}-1`;
          if (await checkImageValidity(n)) return e;
        }
        return null;
      }
      async function getValidImgUrl(t, e) {
        if (!selectedProxyDomain) return null;
        const n = `${selectedProxyDomain}/${t}-${e}`;
        return { originalUrl: n, thumbUrl: n };
      }
      async function batchCheckImages(t, e = 20) {
        const n = [];
        for (let a = 1; a <= e; a++) {
          const proxyUrl = `${selectedProxyDomain}/${t}-${a}`;
          if (await checkImageValidity(proxyUrl)) {
            n.push({ originalUrl: proxyUrl, thumbUrl: proxyUrl, i: a });
          } else {
            break;
          }
        }
        return n;
      }
      function createImageCard(t, e, n, a) {
        const r = document.createElement("div");
        r.className = "image-card";
        const o = document.createElement("img");
        ((o.className = "preview-img img-fluid"),
          (o.src = t),
          (o.loading = "lazy"),
          (o.style.objectFit = "cover"),
          (o.alt = `预览图 ${a}`),
          (o.style.cursor = "pointer"),
          o.addEventListener("click", () => {
            ((currentImgIndex = currentImgList.findIndex((t) => t.i === a)),
              (modalOriginalImg.src = e),
              resetModalState(),
              updateNavBtnState(),
              (imageModal.style.display = "flex"));
          }));
        const i = document.createElement("a");
        return (
          (i.className = "download-btn"),
          (i.href = e),
          (i.target = "_blank"),
          (i.rel = "noopener noreferrer"),
          (i.textContent = "下载原图"),
          r.appendChild(o),
          r.appendChild(i),
          r
        );
      }
      function debounce(t, e = 1e3) {
        let n = null;
        return (...a) => {
          n
            ? showToast("正在解析中，请稍候！", "info")
            : (n = setTimeout(() => {
                (t.apply(this, a), (n = null));
              }, e));
        };
      }
      async function parsePixivUrl() {
        const t = pixivUrlInput.value.trim();
        ((resultContainer.innerHTML = ""),
          (currentArtworkId = null),
          (selectedProxyDomain = null),
          (currentImgList = []),
          (originalLinkContainer.style.display = "none"));
        const e = extractArtworkId(t);
        if (e) {
          resultContainer.innerHTML =
            '<p style="text-align: center; color: var(--text-light); padding: 2rem;">正在解析图片资源，请稍候...</p>';
          try {
            if (
              ((selectedProxyDomain = await selectProxyDomain(e)),
              !selectedProxyDomain)
            )
              return (
                (resultContainer.innerHTML = ""),
                void showToast(
                  "所有代理域名均无法访问该作品首图，请检查 PID 或稍后重试",
                  "error",
                )
              );
            const t = await batchCheckImages(e);
            if (((resultContainer.innerHTML = ""), 0 === t.length))
              return void showToast(
                "未找到可用图片！可能是作品已删或代理失效",
                "error",
              );
            ((currentArtworkId = e),
              (currentImgList = t),
              (originalLinkBtn.href = `https://www.pixiv.net/artworks/${currentArtworkId}`),
              (originalLinkContainer.style.display = "block"),
              t.forEach(({ thumbUrl: t, originalUrl: n, i: a }) => {
                const r = createImageCard(t, n, e, a);
                resultContainer.appendChild(r);
              }),
              showToast(`成功找到 ${t.length} 张图片`, "success"));
          } catch (t) {
            ((resultContainer.innerHTML = ""),
              showToast(
                `解析失败：${t.message}（请检查网络或稍后重试）`,
                "error",
              ));
          }
        } else
          resultContainer.innerHTML =
            '<p class="error">无效输入！请输入 Pixiv 作品链接（含 artworks/xxx）或纯数字 PID</p>';
      }
      (zoomInBtn.addEventListener("click", () => scaleImage(scaleRatio + 0.2)),
        zoomOutBtn.addEventListener("click", () =>
          scaleImage(scaleRatio - 0.2),
        ),
        modalOriginalImg.addEventListener("load", () => {
          const t = modalOriginalImg.naturalWidth,
            e = modalOriginalImg.naturalHeight;
          imgSizeInfo.textContent = `${t} × ${e}`;
        }),
        modalOriginalImg.addEventListener("error", () => {
          imgSizeInfo.textContent = "图片加载失败";
        }),
        prevImgBtn.addEventListener("click", () => {
          currentImgIndex <= 0 || (currentImgIndex--, updateModalImage());
        }),
        nextImgBtn.addEventListener("click", () => {
          currentImgIndex >= currentImgList.length - 1 ||
            (currentImgIndex++, updateModalImage());
        }),
        submitBtn.addEventListener("click", debounce(parsePixivUrl)),
        pixivUrlInput.addEventListener("keydown", (t) => {
          "Enter" === t.key && debounce(parsePixivUrl)();
        }));
    </script>
  </body>
</html>
